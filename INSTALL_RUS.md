## üìã INSTALL ‚Äî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ va_player

(–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —Å–µ—Ä—å–µ–∑–Ω–æ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª—è–ª–æ—Å—å –∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å, –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏)

### üìå –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏–æ–ø–ª–µ–µ—Ä–æ–º —Å –¥–≤—É–º—è –∫–ª—é—á–µ–≤—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ú–æ–¥–µ–ª—å / –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –û–∫—Ä—É–∂–µ–Ω–∏–µ |
|-----------|------------|---------------------|-----------|
| **Gemma-3n** | –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è tool calls (XML-–∑–∞–ø—Ä–æ—Å–æ–≤) | `unsloth/gemma-3n-E4B-it` (4-bit quantized) | `venv_gemma` |
| **XTTS v2** | –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ (Text-to-Speech) | Coqui TTS `tts_models/multilingual/multi-dataset/xtts_v2` | `venv_xtts` |
| **audio_service** | –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ —á–µ—Ä–µ–∑ REST API | Flask + pygame | –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –ª—é–±–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ |

---

### ‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y git python3.11 python3.11-venv python3-pip \
    libportaudio2 exiftool ffmpeg libsndfile1 portaudio19-dev

# –î–ª—è ROCm (AMD GPU) ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è Gemma
# –°–ª–µ–¥—É–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º—É –≥–∞–π–¥—É: https://rocm.docs.amd.com/
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ú–æ–¥–µ–ª—å Gemma —Ç—Ä–µ–±—É–µ—Ç ~6 –ì–ë VRAM –≤ 4-bit –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏–∏. –î–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ GPU —É–≤–µ–ª–∏—á—å—Ç–µ `load_in_4bit = False` ‚Üí `load_in_8bit = True` –≤ –∫–æ–¥–µ, –Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∏–∑–∏—Ç—Å—è.

---

### üîß –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/mml1975/va_player.git
cd va_player
```

---

### üîå –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è XTTS (tts_speak)

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3.11 -m venv venv_xtts
source venv_xtts/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install --upgrade pip
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
pip install TTS sounddevice pygame flask numpy wavio

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
python -c "from TTS.api import TTS; print('XTTS ready')"
```

> **–í–∞–∂–Ω–æ:** –ú–æ–¥–µ–ª—å XTTS v2 (~2.3 –ì–ë) –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ `tts_service.py`.

---

### üß† –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Gemma (pipeline1)

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3.11 -m venv venv_gemma
source venv_gemma/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install --upgrade pip
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
pip install transformers accelerate bitsandbytes sentencepiece
pip install "unsloth[colab-new] @ git+https://github.com/unslothai/unsloth.git"
pip install jupyterlab ipykernel silero-vad wavio sounddevice

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –∫–∞–∫ —è–¥—Ä–∞ Jupyter
python -m ipykernel install --user --name=venv_gemma --display-name "Python 3.11 (Gemma)"
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª—è —Ä–∞–±–æ—Ç—ã —Å 4-bit –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏–µ–π (`load_in_4bit=True`) —Ç—Ä–µ–±—É–µ—Ç—Å—è `bitsandbytes`. –ù–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤.

---

### üéµ –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ—Å–µ—Ä–≤–∏—Å–∞ (playerservice)

```bash
# –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –ª—é–±–æ–º –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏–π, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å venv_xtts
source venv_xtts/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install flask pygame pandas mutagen
```

---

### üìÇ –®–∞–≥ 5: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∞–∑—ã –º—É–∑—ã–∫–∏

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω exiftool (—Å–º. –®–∞–≥ 1)
cd musicbase

# –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–∑–∞–º–µ–Ω–∏—Ç–µ /path/to/music –Ω–∞ –≤–∞—à –ø—É—Ç—å)
./scanm2.sh /path/to/music > musicbase1.csv
python3 tune_exif.py musicbase1.csv musicbase.csv

# –†–µ–∑—É–ª—å—Ç–∞—Ç: musicbase.csv –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
```

---

### ‚ñ∂Ô∏è –®–∞–≥ 6: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö)

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 ‚Äî –ê—É–¥–∏–æ—Å–µ—Ä–≤–∏—Å:**
```bash
source venv_xtts/bin/activate
cd playerservice
python audio_service.py  # –°–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 5000 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 ‚Äî TTS-—Å–µ—Ä–≤–∏—Å:**
```bash
source venv_xtts/bin/activate
cd tts_speak
python tts_service.py    # –°–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 5001 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 3 ‚Äî –ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç (Jupyter):**
```bash
source venv_gemma/bin/activate
cd pipeline1
jupyter lab
```
–û—Ç–∫—Ä–æ–π—Ç–µ `va_ver1.ipynb`, –≤—ã–±–µ—Ä–∏—Ç–µ —è–¥—Ä–æ **"Python 3.11 (Gemma)"** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ —è—á–µ–π–∫–∏ –¥–æ –∫–æ–Ω—Ü–∞.

---

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**tts_speak/tts_config.json** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ TTS-—Å–µ—Ä–≤–∏—Å–∞:
```json
{
  "host": "127.0.0.1",
  "port": 5001,
  "debug": false,
  "default_speaker": "ls_female1.wav",
  "default_language": "en",
  "sample_rate": 24000
}
```

**playerservice/config.json** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ—Å–µ—Ä–≤–∏—Å–∞ (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ).

---

### üîí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–ª—É—à–∞—é—Ç `127.0.0.1` ‚Äî –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –ø–æ—Ä—Ç—ã 5000/5001 –Ω–∞—Ä—É–∂—É –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
2. –ú–æ–¥–µ–ª—å Gemma –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Hugging Face ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ (`unsloth/gemma-3n-E4B-it`).
3. –î–ª—è production-—Å—Ä–µ–¥—ã –¥–æ–±–∞–≤—å—Ç–µ API-–∫–ª—é—á–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.

---

### üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| `OSError: PortAudio library not found` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `libportaudio2` –∏ `portaudio19-dev` (—Å–º. –®–∞–≥ 1) |
| `bitsandbytes` –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `pip install bitsandbytes --prefer-binary` –∏–ª–∏ —Å–æ–±–µ—Ä–∏—Ç–µ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ |
| XTTS –¥–æ–ª–≥–æ –≥—Ä—É–∑–∏—Ç—Å—è –≤–ø–µ—Ä–≤—ã–µ | –ú–æ–¥–µ–ª—å (~2.3 –ì–ë) —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è |
| Gemma —Ç—Ä–µ–±—É–µ—Ç –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏ | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `load_in_4bit = True` –≤ –∫–æ–¥–µ; –¥–ª—è <6 –ì–ë VRAM –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CPU |

---

### üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
va_player/
‚îú‚îÄ‚îÄ musicbase/          # –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –º—É–∑—ã–∫–∏
‚îú‚îÄ‚îÄ playerservice/      # –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (–ø–æ—Ä—Ç 5000)
‚îú‚îÄ‚îÄ tts_speak/          # –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å TTS –Ω–∞ –±–∞–∑–µ XTTS v2 (–ø–æ—Ä—Ç 5001)
‚îú‚îÄ‚îÄ pipeline1/          # Jupyter notebook —Å Gemma-3n (va_ver1.ipynb)
‚îú‚îÄ‚îÄ mic_capture/        # –°–∫—Ä–∏–ø—Ç—ã –∑–∞—Ö–≤–∞—Ç–∞ –∞—É–¥–∏–æ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ (Silero VAD)
‚îú‚îÄ‚îÄ query_dataset/      # –î–∞—Ç–∞—Å–µ—Ç—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ voice1example/      # –ü—Ä–∏–º–µ—Ä—ã –∞—É–¥–∏–æ–∑–∞–ø—Ä–æ—Å–æ–≤
‚îî‚îÄ‚îÄ doc/                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (description_en.md)
```

---

‚úÖ –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ: –≥–æ–≤–æ—Ä–∏—Ç–µ –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ Gemma –∏ –æ—Ç–≤–µ—á–∞–µ—Ç —Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–µ—á—å—é —á–µ—Ä–µ–∑ XTTS.
